<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Attendance.ai â€“ Schedule</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --blue:#1d4ed8;
  --light:#e8efff;
  --bg:#f5f7fb;
  --card:#ffffff;
  --muted:#64748b;
}

*{box-sizing:border-box;font-family:"Segoe UI",sans-serif}
body{margin:0;background:var(--bg)}
.app{display:flex;height:100vh}

/* SIDEBAR */
.sidebar{
  width:240px;background:#fff;padding:20px;
  border-right:1px solid #e5e7eb;
}
.brand{
  display:flex;gap:10px;align-items:center;
  font-size:18px;font-weight:700;color:var(--blue);
  margin-bottom:30px;
}
.brand-icon{
  width:36px;height:36px;border-radius:10px;
  background:var(--blue);color:#fff;
  display:flex;align-items:center;justify-content:center;
}
.nav a{
  display:block;padding:10px 14px;border-radius:12px;
  color:var(--muted);cursor:pointer;
}
.nav a.active{background:var(--light);color:var(--blue)}

/* MAIN */
.main{flex:1;padding:24px;overflow-y:auto}
.card{
  background:#fff;padding:20px;
  border-radius:16px;margin-bottom:20px;
}

select,input,button{
  padding:10px;border-radius:8px;
  border:1px solid #e5e7eb;margin-right:8px;
}
button{background:var(--blue);color:#fff;border:none;cursor:pointer}

.lecture{
  display:flex;justify-content:space-between;
  padding:12px 0;border-bottom:1px solid #e5e7eb;
}

.badge{
  padding:4px 10px;border-radius:12px;
  font-size:12px;
}
.present{background:#ecfeff;color:#0369a1}
.absent{background:#fee2e2;color:#991b1b}
.extra{background:#fef3c7;color:#92400e}

.small{font-size:12px;color:var(--muted)}

/* ===== CALENDAR ===== */
.calendar{
  display:grid;
  grid-template-columns:repeat(53, 12px);
  grid-auto-rows:12px;
  gap:4px;
  margin-top:10px;
}
.day{
  background:#e5e7eb;
  border-radius:3px;
}
.level-1{background:#bfdbfe}
.level-2{background:#60a5fa}
.level-3{background:#2563eb}
.level-4{background:#1e40af}
</style>
</head>

<body>

<div class="app">

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="brand">
    <div class="brand-icon">â—Ž</div>
    Attendance.ai
  </div>
  <nav class="nav">
    <a>Dashboard</a>
    <a class="active">Schedule</a>
    <a>Reports</a>
    <a>Security</a>
    <a>Settings</a>
  </nav>
</aside>

<!-- MAIN -->
<main class="main">

<h2>Schedule</h2>

<!-- WEEK CONFIG -->
<div class="card">
  <strong>Weekly Lecture Configuration</strong>
  <div id="weekConfig" class="small"></div>
</div>

<!-- DAY SELECT -->
<div class="card">
  <strong>Select Day</strong><br><br>
  <select id="daySelect" onchange="loadLectures()">
    <option>Monday</option>
    <option>Tuesday</option>
    <option>Wednesday</option>
    <option>Thursday</option>
    <option>Friday</option>
    <option>Saturday</option>
  </select>
</div>

<!-- LECTURES -->
<div class="card">
  <strong>Lectures</strong>
  <div id="lectureList"></div>
</div>

<!-- ADD SESSION -->
<div class="card">
  <strong>Add Lecture / Extra Session</strong><br><br>
  <input id="subject" placeholder="Subject">
  <input id="time" placeholder="Time (10:00 - 11:00)">
  <button onclick="addLecture()">Add</button>
</div>

<!-- ðŸ”¥ ATTENDANCE CALENDAR -->
<div class="card">
  <strong>Attendance Activity</strong>
  <div class="calendar" id="calendar"></div>
  <p class="small">Darker color = more lectures attended</p>
</div>

</main>
</div>

<script>
async function api(url, options = {}) {
  const res = await fetch(url, {
    credentials:"include",
    headers:{ "Content-Type":"application/json" },
    ...options
  });
  return res.json();
}

/* WEEK CONFIG */
async function loadWeekConfig(){
  const data = await api("/api/schedule/week");
  weekConfig.innerHTML = data.map(d=>`${d.day}: ${d.lectures}`).join("<br>");
}

/* LECTURES */
async function loadLectures(){
  const day = daySelect.value;
  const lectures = await api(`/api/schedule/lectures?day=${day}`);
  lectureList.innerHTML = lectures.map(l=>`
    <div class="lecture">
      <div>
        <strong>${l.subject}</strong><br>
        <span class="small">${l.time}</span>
        ${l.extra?'<span class="badge extra">Extra</span>':''}
      </div>
      <div>
        <span class="badge ${l.present?'present':'absent'}">
          ${l.present?'Present':'Absent'}
        </span>
        <button onclick="toggleAttendance(${l.id})">Toggle</button>
      </div>
    </div>
  `).join("");
}

async function toggleAttendance(id){
  await api("/api/schedule/attendance",{method:"POST",body:JSON.stringify({lectureId:id})});
  loadLectures();
  loadCalendar();
}

/* ADD LECTURE */
async function addLecture(){
  await api("/api/schedule/lecture",{method:"POST",body:JSON.stringify({
    day:daySelect.value,subject:subject.value,time:time.value,extra:true
  })});
  subject.value="";time.value="";
  loadLectures();loadCalendar();
}

/* ðŸ”¥ CALENDAR */
async function loadCalendar(){
  const data = await api("/api/schedule/calendar");
  calendar.innerHTML="";
  data.forEach(d=>{
    let level = d.count>=5?4:d.count>=3?3:d.count>=1?2:0;
    calendar.innerHTML += `<div class="day level-${level}" title="${d.date}: ${d.count} lectures"></div>`;
  });
}

/* INIT */
loadWeekConfig();
loadLectures();
loadCalendar();
</script>

</body>
</html>
